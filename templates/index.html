<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>虚假新闻生成器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">虚假新闻生成器（纯娱乐）</h1>
        <p class="disclaimer text-center text-danger">声明：以下内容纯属虚构，请勿当真！</p>
        <button id="theme-toggle" class="btn btn-outline-secondary mb-3">切换主题</button>
        
        <div class="card p-4 mb-4">
            <form method="POST">
                <div class="mb-3">
                    <label for="category" class="form-label">选择板块：</label>
                    <select name="category" id="category" class="form-select">
                        <option value="">随机</option>
                        <option value="international">国际时事</option>
                        <option value="gossip">明星八卦</option>
                        <option value="tech">科技伦理</option>
                        <option value="social">社会热点</option>
                        <option value="daily">家常理短</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="custom_word" class="form-label">自定义关键词（可选）：</label>
                    <input type="text" name="custom_word" id="custom_word" class="form-control" placeholder="如：外星人">
                </div>
                
                <button type="submit" class="btn btn-danger">生成新闻</button>
            </form>
            <button type="button" id="refresh-btn" class="btn btn-warning mt-2">刷新一条</button>
        </div>
        
        <div class="news-output">
            {% if news_list %}
                <h2>生成的新闻</h2>
                <ul class="list-group" id="news-list">
                    {% for news in news_list %}
                        <li class="list-group-item">
                            <strong>{{ news.category }}</strong>: {{ news.headline }}
                            <p class="comment text-muted">网友评论：{{ news.comment }}</p>
                        </li>
                    {% endfor %}
                </ul>
                <button type="button" id="load-more-btn" class="btn btn-secondary mt-3">生成更多</button>
            {% endif %}
        </div>

        <div class="history mt-5">
            <h2>历史记录（最近 50 条）</h2>
            {% if history %}
                <ul class="list-group">
                    {% for item in history %}
                        <li class="list-group-item">
                            <strong>{{ item.category }}</strong>: {{ item.headline }}
                            <p class="comment text-muted">网友评论：{{ item.comment }}</p>
                        </li>
                    {% endfor %}
                </ul>
                <nav aria-label="Page navigation" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if page > 1 %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page - 1 }}">上一页</a>
                            </li>
                        {% endif %}
                        {% for p in range(1, total_pages + 1) %}
                            <li class="page-item {% if p == page %}active{% endif %}">
                                <a class="page-link" href="?page={{ p }}">{{ p }}</a>
                            </li>
                        {% endfor %}
                        {% if page < total_pages %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page + 1 }}">下一页</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% else %}
                <p>暂无历史记录，快来生成吧！</p>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('refresh-btn').addEventListener('click', function() {
            const category = document.getElementById('category').value;
            const customWord = document.getElementById('custom_word').value;
            
            fetch('/generate_one', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `category=${category}&custom_word=${customWord}`
            })
            .then(response => response.json())
            .then(data => {
                const output = document.querySelector('.news-output .list-group') || document.createElement('ul');
                if (!document.querySelector('.news-output .list-group')) {
                    document.querySelector('.news-output').innerHTML = '<h2>生成的新闻</h2>';
                    output.classList.add('list-group');
                    document.querySelector('.news-output').appendChild(output);
                }
                const li = document.createElement('li');
                li.classList.add('list-group-item');
                li.innerHTML = `<strong>${data.category}</strong>: ${data.headline}<p class="comment text-muted">网友评论：${data.comment}</p>`;
                output.insertBefore(li, output.firstChild);
                if (output.children.length > 3) output.removeChild(output.lastChild);
            });
        });

        document.getElementById('load-more-btn')?.addEventListener('click', function() {
            const category = document.getElementById('category').value;
            const customWord = document.getElementById('custom_word').value;
            
            fetch('/generate_one', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `category=${category}&custom_word=${customWord}`
            })
            .then(response => response.json())
            .then(data => {
                const output = document.getElementById('news-list');
                const li = document.createElement('li');
                li.classList.add('list-group-item');
                li.innerHTML = `<strong>${data.category}</strong>: ${data.headline}<p class="comment text-muted">网友评论：${data.comment}</p>`;
                output.appendChild(li);
            });
        });

        const toggleButton = document.getElementById('theme-toggle');
        const body = document.body;
        toggleButton.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
        });
        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
        }
    </script>
</body>
</html>